/*!
 * fileLogger
 * Copyright 2016 Peter Bakondy https://github.com/pbakondy
 * See LICENSE in this repository for license information
 */
!function(){angular.module("fileLogger",["ngCordova.plugins.file"]).factory("$fileLogger",["$q","$window","$cordovaFile","$timeout","$filter",function(e,o,r,n,a){"use strict";function t(){return o.parent&&o.parent.ripple}function i(){return!o.cordova&&!o.PhoneGap&&!o.phonegap||t()}function l(e){e&&(e.timestamp=(new Date).toISOString(),O.push({message:JSON.stringify(e)+",\n"}),b||s())}function c(e){angular.isString(e)?(e=e.toUpperCase(),j.indexOf(e)===-1&&(e="INFO")):e="INFO";for(var o,r=new Date,n=F?a("date")(r,F,S):r.toJSON(),t=Array.prototype.slice.call(arguments,1),l=[n,e],c=0;c<t.length;c++)if(angular.isArray(t[c])){o="[Array]";try{o=JSON.stringify(t[c])}catch(f){}l.push(o)}else if(angular.isObject(t[c])){o="[Object]";try{o=JSON.stringify(t[c])}catch(f){}l.push(o)}else l.push(t[c]);if(i()){if(t.unshift(n),angular.isObject(console)&&angular.isFunction(console.log))switch(e){case"DEBUG":angular.isFunction(console.debug)?console.debug.apply(console,t):console.log.apply(console,t);break;case"INFO":angular.isFunction(console.info)?console.info.apply(console,t):console.log.apply(console,t);break;case"WARN":angular.isFunction(console.warn)?console.warn.apply(console,t):console.log.apply(console,t);break;case"ERROR":angular.isFunction(console.err)?console.error.apply(console,t):console.log.apply(console,t);break;default:console.log.apply(console,t)}}else console.log(l.join(" "));O.push({message:l.join(" ")+"\n"}),b||s()}function s(){if(!O.length)return void(b=!1);b=!0;var e=O.shift();f(e.message).then(function(){n(function(){s()})},function(){n(function(){s()})})}function f(n){var a=e.defer();if(i())o.localStorage[w]||(o.localStorage[w]=""),o.localStorage[w]+=n,a.resolve();else{if(!o.cordova||!o.cordova.file||!o.cordova.file.dataDirectory)return a.reject("cordova.file.dataDirectory is not available"),a.promise;r.checkFile(cordova.file.dataDirectory,w).then(function(){r.writeExistingFile(cordova.file.dataDirectory,w,n).then(function(){a.resolve()},function(e){a.reject(e)})},function(){r.writeFile(cordova.file.dataDirectory,w,n,!0).then(function(){a.resolve()},function(e){a.reject(e)})})}return a.promise}function u(){var n=e.defer();if(i())n.resolve(o.localStorage[w]);else{if(!o.cordova||!o.cordova.file||!o.cordova.file.dataDirectory)return n.reject("cordova.file.dataDirectory is not available"),n.promise;r.readAsText(cordova.file.dataDirectory,w).then(function(e){n.resolve(e)},function(e){n.reject(e)})}return n.promise}function p(){var n=e.defer();if(i())o.localStorage.removeItem(w),n.resolve();else{if(!o.cordova||!o.cordova.file||!o.cordova.file.dataDirectory)return n.reject("cordova.file.dataDirectory is not available"),n.promise;r.removeFile(cordova.file.dataDirectory,w).then(function(e){n.resolve(e)},function(e){n.reject(e)})}return n.promise}function d(e){return!!(angular.isString(e)&&e.length>0)&&(w=e,!0)}function g(e,o){if(!angular.isUndefined(e)&&!angular.isString(e))throw new TypeError("format parameter must be a string or undefined");if(!angular.isUndefined(o)&&!angular.isString(o))throw new TypeError("timezone parameter must be a string or undefined");F=e,S=o}function v(){var n=e.defer();if(i())n.resolve({name:w,localURL:"localStorage://localhost/"+w,type:"text/plain",size:o.localStorage[w]?o.localStorage[w].length:0});else{if(!o.cordova||!o.cordova.file||!o.cordova.file.dataDirectory)return n.reject("cordova.file.dataDirectory is not available"),n.promise;r.checkFile(cordova.file.dataDirectory,w).then(function(e){e.file(n.resolve,n.reject)},n.reject)}return n.promise}function y(){var e=Array.prototype.slice.call(arguments,0);e.unshift("DEBUG"),c.apply(void 0,e)}function h(){var e=Array.prototype.slice.call(arguments,0);e.unshift("INFO"),c.apply(void 0,e)}function m(){var e=Array.prototype.slice.call(arguments,0);e.unshift("WARN"),c.apply(void 0,e)}function D(){var e=Array.prototype.slice.call(arguments,0);e.unshift("ERROR"),c.apply(void 0,e)}var F,S,O=[],b=!1,j=["DEBUG","INFO","WARN","ERROR"],w="messages.log";return{logEvent:l,log:c,getLogfile:u,deleteLogfile:p,setStorageFilename:d,setTimestampFormat:g,checkFile:v,debug:y,info:h,warn:m,error:D}}])}();